<!DOCTYPE html>
<html lang="en-us" dir="ltr">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  <meta http-equiv="content-language" content="en-us" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />

  
  
  <title>Automating Token Generation for Apple School Managers New API &middot; CantScript</title>
  <meta name="title" content="Automating Token Generation for Apple School Managers New API &middot; CantScript" />
  

  
  
  <meta name="description" content="I was looking at the new documentation when an article from Bart Reardon landed on my desk. He&#39;d done the work already, so I went and automated the hell out of it" />
  
  <meta name="keywords" content="Workflows, API, " />
  <link rel="canonical" href="http://localhost:1313/posts/automating-token-generation-for-apple-school-managers-new-api/" />

  

  
    
        <link rel="stylesheet" href="/css/theme.css">
    
  
    
        <link rel="stylesheet" href="/css/main.css">
    
  
    
  



  
  
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="CantScript" />
<link rel="manifest" href="/site.webmanifest" />


  

  <meta property="og:url" content="http://localhost:1313/posts/automating-token-generation-for-apple-school-managers-new-api/">
  <meta property="og:site_name" content="CantScript">
  <meta property="og:title" content="Automating Token Generation for Apple School Managers New API">
  <meta property="og:description" content="I was looking at the new documentation when an article from Bart Reardon landed on my desk. He’d done the work already, so I went and automated the hell out of it">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-13T00:00:00+00:00">
    <meta property="article:tag" content="Workflows">
    <meta property="article:tag" content="API">

  
    <meta property="og:image" content="http://localhost:1313/ASMAPIBanner.png" />
  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Automating Token Generation for Apple School Managers New API">
  <meta name="twitter:description" content="I was looking at the new documentation when an article from Bart Reardon landed on my desk. He’d done the work already, so I went and automated the hell out of it">

  
    <meta name="twitter:image" content="http://localhost:1313/ASMAPIBanner.png" />
  

  
  







  
  
    <script
      defer
      type="text/javascript"
      src="/lib/fuse/fuse.min.1f56d60a7738743270762a2aa4e0a453be99c4476f06f3b2f51f4377d12a7ed973420f76a308d7e4855d88ec34d25940c9015464934faf30e7599fe566d7f6e4.js"
      integrity="sha512-H1bWCnc4dDJwdioqpOCkU76ZxEdvBvOy9R9Dd9EqftlzQg92owjX5IVdiOw00llAyQFUZJNPrzDnWZ/lZtf25A=="
    ></script>
  



  
  


  
  
  
  
  

  
  
  
    <link rel="preload" href="http://localhost:1313/fonts/Ubuntu-Regular.woff2" as="font" type="font/woff2" crossorigin>
  

  

  

  
  <script>
    const siteTheme = "dark";
    let savedTheme = localStorage.getItem('theme') || siteTheme;
    if (savedTheme == 'auto') {
      if ( window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ) {
        savedTheme = 'dark';
      }
    }
    if (savedTheme === "dark") {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    }
  </script>
  
  

<script src="https://cdn.counter.dev/script.js" data-id="4f40f3ac-7039-4087-b21a-96d3879a1fdc" data-utcoffset="1"></script>
  
</head>

  <body>
    <div class="content">
      <header>
    
    <a class="title" href="/">
      
      















  
  
  
    
  

  
    <img loading="" 

    
      
        
        
        
          
          
          
            src="/img/CantScript_LogoOnlyv3_hu_8dd51e941f19ba6f.png"
          
        
      
    
      alt="Site Logo" />
  




    </a>
    
    <div class="header-cntr">
    <a class="title" href="/">
    <span>CantScript</span>
    </a>
  <div class="menu">
  <nav id="main-menu" class="mm-normal">
    <ul>
    <li> <button id="mob-x-icon" class="menu-btn" arial-label="x-icon"> 

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>


 </button> </li>
    
      <li><a href="/posts/" aria-label="posts">
      Posts</li></a>
    
      <li><a href="/about/" aria-label="about">
      About</li></a>
    
      <li><a href="/more/" aria-label="more">
      More</li></a>
    
      <li><a href="https://github.com/cantscript" aria-label="github">
      
        <span>
          

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>



        </span>
          </li></a>
    
      <li><a href="https://www.linkedin.com/in/anthony-darlow-a795b294/" aria-label="linkedin">
      
        <span>
          

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>



        </span>
          </li></a>
    
      <li><a href="https://macadmins.slack.com/team/UA73QAKJL" aria-label="slack">
      
        <span>
          

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>



        </span>
          </li></a>
    
    </ul>
  </nav>
    <div class="side-menu">
    
<button id="search-open" class="menu-btn" aria-label="Search button">
  

    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>



</button>

<div id="search-container" data-url="http://localhost:1313/">
  <div class="search">
    <div class="panel">
      <form>
        

    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>



        <input type="search" id="search-query" placeholder="Search" tabindex=0 autocomplete="off"/>
        <button id="search-close" title="Cancel (ESC)">
          

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>



        </button>
      </form>
    </div>
    <ul id="search-results">
      
      
      
      
      
      
      
      
      
      
    </ul>
    <div id="search-overlay"></div>
  </div>
</div>

    
    <button id="theme-switcher" class="menu-btn" aria-label="Theme switcher">
      <div id="moon">
      

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>



      </div>
      <div id="sun">
      

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>



      </div>
    </button>
    
    </div>
    <button id="mob-hb-icon" class="menu-btn" aria-label="Hamburger icon">
      

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>



    </button>
  </div>
  <script>
  (function() {
    document.addEventListener('DOMContentLoaded', function() {
    const openBtn = document.getElementById('mob-hb-icon');
    const closeBtn = document.getElementById('mob-x-icon');
    const mainMenu = document.getElementById('main-menu');
    const body = document.body;

    openBtn.addEventListener('click', function() {
        mainMenu.classList.replace('mm-normal', 'mm-mobile-open');
        closeBtn.style.display = 'block';
        body.style.overflow = 'hidden';
    });
    closeBtn.addEventListener('click', function() {
        mainMenu.classList.replace('mm-mobile-open', 'mm-normal');
        closeBtn.style.display = 'none';
        body.style.overflow = '';
    });
    })
  })();
  </script>
  
  <script>
  (function() {
    var mainmenu = document.getElementById('main-menu');
    if (!mainmenu) return;

    var path = window.location.pathname;
    var links = mainmenu.querySelectorAll('a');

    links.forEach(function(link) {
      if (link.getAttribute('href') === path) {
        link.classList.add('active');
      }
    });
  })();
  </script>
  
</div>
</header>

      <main>
        



  
  















  
  
  

  
    <img loading="eager" class="cover-img"

    
      
        src="/posts/automating-token-generation-for-apple-school-managers-new-api/ASMAPIBanner.png"
      
    
      alt="Cover Image" />
  









<ul class="breadcrumbs">
  <li><a href="http://localhost:1313/">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="currentColor" d="M575.8 255.5c0 18-15 32.1-32 32.1l-32 0 .7 160.2c0 2.7-.2 5.4-.5 8.1l0 16.2c0 22.1-17.9 40-40 40l-16 0c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1L416 512l-24 0c-22.1 0-40-17.9-40-40l0-24 0-64c0-17.7-14.3-32-32-32l-64 0c-17.7 0-32 14.3-32 32l0 64 0 24c0 22.1-17.9 40-40 40l-24 0-31.9 0c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2l-16 0c-22.1 0-40-17.9-40-40l0-112c0-.9 0-1.9 .1-2.8l0-69.7-32 0c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>


</a></li>
  
    
    
      <li><a href="http://localhost:1313/posts/">Posts</a></li>
    
    
  
    
  
</ul>



<h1 class="pg-title">Automating Token Generation for Apple School Managers New API</h1>


<div class="meta">
  



<p>


  
  
  <span class="meta-icon">

    <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="currentColor" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19,4H17V3a1,1,0,0,0-2,0V4H9V3A1,1,0,0,0,7,3V4H5A3,3,0,0,0,2,7V19a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V7A3,3,0,0,0,19,4Zm1,15a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V12H20Zm0-9H4V7A1,1,0,0,1,5,6H7V7A1,1,0,0,0,9,7V6h6V7a1,1,0,0,0,2,0V6h2a1,1,0,0,1,1,1Z"/></svg>


</span>
  Posted on <time datetime="2025-06-13T00:00:00&#43;00:00">Jun 13, 2025</time>
  
  
  


  <span class="meta-icon">

    <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M23 12C23 18.0751 18.0751 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12ZM3.00683 12C3.00683 16.9668 7.03321 20.9932 12 20.9932C16.9668 20.9932 20.9932 16.9668 20.9932 12C20.9932 7.03321 16.9668 3.00683 12 3.00683C7.03321 3.00683 3.00683 7.03321 3.00683 12Z" fill="currentColor"/>
<path d="M12 5C11.4477 5 11 5.44771 11 6V12.4667C11 12.4667 11 12.7274 11.1267 12.9235C11.2115 13.0898 11.3437 13.2343 11.5174 13.3346L16.1372 16.0019C16.6155 16.278 17.2271 16.1141 17.5032 15.6358C17.7793 15.1575 17.6155 14.5459 17.1372 14.2698L13 11.8812V6C13 5.44772 12.5523 5 12 5Z" fill="currentColor"/>
</svg>


</span>
  
    8 mins
  


</p>

  


<p>
  <span class="meta-icon"> 

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M48 32H197.5C214.5 32 230.7 38.74 242.7 50.75L418.7 226.7C443.7 251.7 443.7 292.3 418.7 317.3L285.3 450.7C260.3 475.7 219.7 475.7 194.7 450.7L18.75 274.7C6.743 262.7 0 246.5 0 229.5V80C0 53.49 21.49 32 48 32L48 32zM112 176C129.7 176 144 161.7 144 144C144 126.3 129.7 112 112 112C94.33 112 80 126.3 80 144C80 161.7 94.33 176 112 176z"/></svg>


 </span>
  
  <a class="tag" href="/tags/workflows/">Workflows</a>
  
  <a class="tag" href="/tags/api/">API</a>
  
</p>



</div>




  <div class="toc">
    <details >
      <summary accesskey="c" title="(Alt+C)">
        Table of Contents
      </summary>
      <div class="toc-innr">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#looking-at-barts-script">Looking At Barts Script</a></li>
        <li><a href="#smart-automation-or-over-engineered">Smart Automation or Over Engineered?</a></li>
        <li><a href="#the-solution-i-built">The Solution I Built</a></li>
        <li><a href="#configuring-the-automation">Configuring the Automation</a></li>
        <li><a href="#using-the-code">Using the Code</a></li>
        <li><a href="#a-quick-note">A Quick Note</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </details>
  </div>
  



<p>Like many of us, this week has been spent watching as many WWDC videos I can fit in as well as looking through all the new documentation.</p>
<p>One of the most antisipated sessions for us Apple Admins, or at least me, is the <a href="https://developer.apple.com/videos/play/wwdc2025/258/?time=71" target="_blank">What&rsquo;s New In Apple Device Management and Identity</a>
 session. There was lots to be excited about but one thing that particularly got my attention was access to a new AxM API.</p>
<p>I watched the video on the Tuesday morning <em>(since Im in the UK, Im not one to stay up all night watching these things)</em> and before I even got to my desk messages were pinging around with links to newly released <a href="https://developer.apple.com/documentation/apple-school-and-business-manager-api" target="_blank">AxM API Documentation</a>
</p>
<p>Despite it not really being on my list of things to do that day, I went to have a look at it. With a quick scan I could see there was a section about how to <a href="https://developer.apple.com/documentation/apple-school-and-business-manager-api/implementing-oauth-for-the-apple-school-and-business-manager-api" target="_blank">authenicate to gain access to the API</a>
. In a nutshell it looked like, copy and paste some things from AxM, create a token, use that token to create <em>another</em> token and then use that to made the API calls.</p>
<p>Theres an example python script there but as I said, it wasn&rsquo;t really on my list of things to do on that day. I thought to myself: <em>&ldquo;I&rsquo;ll come back to it when I have some more time. Might be nice to figure out how to do all this with Bash though&rdquo;</em></p>
<p>Life went on.</p>
<p>Wednesday rolled around and another message landed with a link for <a href="https://bartreardon.github.io/2025/06/11/using-the-new-api-for-apple-business-school-manager.html" target="_blank">Using the new API for Apple Business/School Manager</a>
 by Bart Reardon. Bart had already turned the docs into plain english and with a step by step guide but even better, produced a <code>ZSH</code> script. On a side note, once I&rsquo;d look at it I realised I was never going to figure out how to produce a bash script from the example phyton script&hellip;.not without our good old friend ChatGTP.</p>
<p>So, this blog is <strong><em>NOT</em></strong> to give you a step by step guide on how this all works since Bart already did a great job with his blog.</p>

  


<div class="callout"
  
>
<span class="icon"

>


    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM256 128c17.67 0 32 14.33 32 32c0 17.67-14.33 32-32 32S224 177.7 224 160C224 142.3 238.3 128 256 128zM296 384h-80C202.8 384 192 373.3 192 360s10.75-24 24-24h16v-64H224c-13.25 0-24-10.75-24-24S210.8 224 224 224h32c13.25 0 24 10.75 24 24v88h16c13.25 0 24 10.75 24 24S309.3 384 296 384z"/></svg>



</span>
<span class="txt"

>
So, if you haven&rsquo;t already, go read that and then come back and pick up here.
</span>
</div>

<p>Instead I want to talk about what I&rsquo;ve done since seeing his <code>ZSH</code> script. At this point I can&rsquo;t decide if I&rsquo;ve used smarts to automated the hell out of it&hellip;.or over engineered a solution to a problem that isn&rsquo;t going to exist! In any case, I had fun with the little project so Im here to share.</p>

<h3 id="looking-at-barts-script">
  Looking At Barts Script
  
</h3>
<p>As I mentioned, in a nutshell you have to generate a few tokens before you can even make an API call in the first place. Of course, this make things more secure but it also makes things more complicated.</p>
<p>The first <code>token</code> you have to create is an <code>Client Assertion</code>, you then use this to generate a <code>Access Token</code> and with the <code>Access Token</code> you can finally make an API call.</p>
<p>The <code>Client Assertion</code> is valid for 180 days (assuming it wasn&rsquo;t revoked in AxM by an Admin in the mean time). So once you&rsquo;ve created this once, you haven&rsquo;t got to worry about it again for quite some time.</p>
<p>The <code>Access Token</code> only lasts for an hour, which again isn&rsquo;t a bad thing from a security point of view. Once its expired you must create another one with a valid <code>Client Assertion</code></p>
<p>While looking at Barts script you can see all of these pieces. The thing was the result of getting the <code>Client Assertion</code> was written out to a text file, you needed to go an copy paste that into variable into another script that is actually making the API call in order to create the <code>Access Token</code> which was stored locally in that script.</p>
<p>So if I were running or testing multiple scripts I&rsquo;d have to copy / paste that <code>Access Token</code> into many (since it seems wasteful to create a new one in each and every script if I had a valid one elsewhere). Then want happens when I can&rsquo;t actually remember which script has a valid <code>Access Token</code>, remember they are only valid for an hour.</p>
<p>Even with just testing, nevermind writing something now and not coming to to it for weeks or months. I feel like I&rsquo;d be forever generating that <code>Access Token</code>. For me this is taking away from the thing I want to spend more time working on, the AxM API and any automations I might want or need.</p>
<p>The <code>Client Assertion</code> isn&rsquo;t really the issue here since its got a much longer expiration.</p>

<h3 id="smart-automation-or-over-engineered">
  Smart Automation or Over Engineered?
  
</h3>
<p>So I setout spliting out some of these componets to that all I ever needed to do in my AxM API scripts is add to lines of code at the top and it would take care of the <code>Access Token</code> management.</p>
<p>If the <code>Access Token</code> didn&rsquo;t even exist, they&rsquo;ll check the <code>Client Assertion</code> is still valid and go ahead and create a new <code>Access Token</code></p>
<p>If the <code>Access Token</code> exist, they&rsquo;ll check that its still valid <em>(ie, 60 mins old)</em> but if not, they&rsquo;ll go ahead and create a a new <code>Access Token</code> providing there is a valid <em>(in date)</em> <code>Client Assertion</code></p>
<p>This way, wether its becuase I&rsquo;m testing or if its becuase in production I only run this script every few months, I know my API calls will work. Further to this since its only 2 lines of code at the start of my script, its not bloated with logic and checks, again letting me just focus on the task at hand.</p>
<p>As I say, its to been seen if this is even a problem we&rsquo;ll have. If it is, what I did to make the above a reality sways over to the <strong>Over Engineered</strong> side.</p>

<h3 id="the-solution-i-built">
  The Solution I Built
  
</h3>
<p>You can find <strong>the project</strong> over on my <strong>GitHub</strong> but lets take a few moment to see what I came up with</p>
<ol>
<li>Built a Script that only deals with creating the <code>Client Assertion</code></li>
<li>Saves the <code>Client Assertion</code> to a text file, along with a date/time stamp 180 days later</li>
<li>Built a second Script that only handle the creation of the <code>Access Token</code></li>
<li>Saves the <code>Access Token</code> to a text file, along with a timestamp 60 mins later</li>
<li>Should an <code>Access Token</code> not exist, the second script will create an <code>Access Token</code> providing the  <code>Client Assertion</code> is still valid based on its date/time stamp</li>
<li>Should there be an <code>Access Token</code> but its not valid based on its timestamp, the second script will create a new valid <code>Access Token</code>, again providing the <code>Client Assertion</code> is still valid based on its date/time</li>
<li>Enables two lines of code in the actual API script that creates/checks/renews the <code>Access Token</code> and saves the value into a variable for use in that script</li>
</ol>
<p>This is all contained in a folder structure so as long as you add the scripts that interact with the API in the root of this folder, you only need to add the <code>values</code> you need from Axm to the <em>Create Client Assertion</em> and <em>Create Access Token</em> scripts once and no other variables are needed to make the automation work.</p>

<h3 id="configuring-the-automation">
  Configuring the Automation
  
</h3>
<p>First things first, if you haven&rsquo;t already go and read <a href="https://bartreardon.github.io/2025/06/11/using-the-new-api-for-apple-business-school-manager.html" target="_blank">Barts blog</a>
 so that you know how to configure ASM. From ASM you&rsquo;ll need</p>
<ul>
<li><code>The Private Key File</code> which will end in .pem <br></li>
<li><code>Client ID</code> <br></li>
<li><code>Key ID</code></li>
</ul>
<p><strong>Step 1</strong> <br></p>
<ul>
<li>Download the <code>AxM_API</code> folder from the <a href="https://github.com/cantscript/AxM_API" target="_blank">GitHub repo</a>
.</li>
</ul>
<p>It doesn&rsquo;t matter where this folder lives on the device as long as you know where you keep it as this is going to become the working folder for all of your ASM API scripts</p>
<p><strong>Step 2</strong> <br>
Take your <code>Private Key File</code> and move it into the <code>AxM-API/AxMCert</code> folder</p>
<p><strong>Step 3</strong> <br></p>
<ul>
<li>Open <code>AxM-API/AutomationScript/create_client_assertion.sh</code> in a text/code editor <br></li>
<li>Enter the name of your <code>Private Key File</code> (so for example <code>myPrivateKey.pem</code>, not the location of the file) into the <code>private_key_file</code> variable <br></li>
<li>Enter your <code>Client ID</code> into the <code>client_id</code> variable <br></li>
<li>Enter your <code>Key ID</code> into the <code>key_id</code> variable <br></li>
<li>Save and close</li>
</ul>
<p><strong>Step 4</strong> <br></p>
<ul>
<li>Open <code>AxM-API/AutomationScript/create_access_token.sh</code> in a text/code editor <br></li>
<li>Enter your <code>Client ID</code> into the <code>client_id</code> variable <br></li>
<li>Comment out either <code>scope=&quot;school.api&quot;</code> or <code>scope=&quot;business.api&quot;</code> depending on if you are interacting with ASM or ABM <br></li>
<li>Save and close</li>
</ul>
<p><strong>Step 5</strong> <br></p>
<ul>
<li>Run <code>AxM-API/AutomationScript/create_client_assertion.sh</code></li>
</ul>

<h3 id="using-the-code">
  Using the Code
  
</h3>
<p>Any script that you want to use that interacts with the AxM API needs save to the root of the <code>AxM_API</code> folder.</p>
<p>I&rsquo;ve given a simple example script within the <code>AxM_API</code> folder.</p>
<p>Your scripts just need the following two lines at the top</p>








  
  
  
    
  
  
  
  
  
  
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./AutomationScripts/create_access_token.sh
</span></span><span style="display:flex;"><span>accessToken<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>awk -F<span style="color:#e6db74">&#39;: &#39;</span> <span style="color:#e6db74">&#39;/^AccessToken:/ {print $2}&#39;</span> ./Tokens/access_token_format.txt<span style="color:#66d9ef">)</span>
</span></span></code></pre></div>


<p>Then you will use the <code>accessToken</code> variable as the bearer token in a call. Below is a simple example.</p>








  
  
  
    
  
  
  
  
  
  
  <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl <span style="color:#e6db74">&#34;https://api-school.apple.com/v1/mdmServers&#34;</span> -H <span style="color:#e6db74">&#34;Authorization: Bearer </span><span style="color:#e6db74">${</span>accessToken<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div>


<p>Notice that as part of the setup with didn&rsquo;t run the <code>create_access_token.sh</code>? Thats becuase on the first run of any script, the automation will see that there isn&rsquo;t one and will generate it on the fly for you.</p>
<p>The next part is up to you! How you interact with AxM and the automations and workflow you create is actually the hard part and the part that gets the job done.</p>
<p>If you haven&rsquo;t already seen, here are the [Apple Documents for the <a href="https://developer.apple.com/documentation/appleschoolmanagerapi" target="_blank">ASM Endpoints</a>
 or <a href="https://developer.apple.com/documentation/applebusinessmanagerapi" target="_blank">ABM Endpoints</a>
</p>

<h3 id="a-quick-note">
  A Quick Note
  
</h3>
<p>Although the scripts take care of keeping the <code>Access Token</code> valid, I didn&rsquo;t actually build in any &ldquo;self renewal&rdquo; of the <code>Client Assertion</code>. If this becomes invalid due to being over 180 days old, everything will just exit and error out.</p>
<p>So if you need to renew this, run <code>AxM-API/AutomationScript/create_client_assertion.sh</code> again.</p>
<p><em>&ldquo;You took the time to self renew the <code>Access Token</code> so why not the <code>Client Assertion</code>&rdquo;</em>. Great Question! I just didn&rsquo;t, at least not today. Maybe next time I have a few minutes and I don&rsquo;t have a project Im not working on</p>











<nav class="pagenav">
  
    <a class="prev" href="/posts/advanced-setup-manager-flows-in-jamf-school/">
      <span class="direction">« Prev</span>
      <br>
      <span> Advanced Setup Manager Flows in Jamf School, Part 1 </span>
    </a>
  
  
    <a class="next" href="/posts/macos-authenticated-enrollment-passthrough-in-jamf-school/">
      <span class="direction">Next »</span>
      <br>
      <span> macOS Authenticated Enrolment Passthrough in Jamf School </span>
    </a>
  
</nav>








      </main>
      <footer>
  <div class="copyright">
     © 2025  Anthony Darlow 
  </div>
  
  <div class="attribution">
    Built with <a href="https://gohugo.io" target="_blank">Hugo</a> & <a href="https://github.com/mnjm/kayal" target="_blank">Kayal</a>
  </div>
  
  
  <div>Last update Aug 9, 2025</div>
  
</footer>

    </div>
    


  



  



  
    
        <script src="/js/theme.js"></script>
      
    
  

  
    
        <script src="/js/codecopy.js"></script>
      
    
  

  
    
        <script src="/js/search.js"></script>
      
    
  


  </body>
</html>
